<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¥ Compteur</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Ã‰cran de sÃ©lection de session -->
    <div id="session-screen" class="screen active">
        <div class="login-container">
            <h1 class="logo">ğŸ¥ CrÃªpe-Master</h1>
            <p class="tagline">Rejoins ou crÃ©e une session</p>
            
            <div class="session-tabs">
                <button id="join-tab" class="tab-btn active">Rejoindre</button>
                <button id="create-tab" class="tab-btn">CrÃ©er</button>
            </div>

            <!-- Rejoindre une session -->
            <form id="join-session-form" class="tab-content active">
                <div class="input-group">
                    <input 
                        type="text" 
                        id="session-code-input" 
                        placeholder="Code de session" 
                        required
                        autocomplete="off"
                    >
                </div>
                <button type="submit" class="btn-primary">Rejoindre la session</button>
                <div id="session-error" class="error-message"></div>
            </form>

            <!-- CrÃ©er une session -->
            <form id="create-session-form" class="tab-content">
                <div class="input-group">
                    <input 
                        type="text" 
                        id="new-session-name" 
                        placeholder="Nom de la session" 
                        required
                        autocomplete="off"
                    >
                </div>
                <div class="input-group">
                    <input 
                        type="text" 
                        id="new-session-code" 
                        placeholder="Code de session (unique)" 
                        required
                        autocomplete="off"
                    >
                </div>
                <button type="submit" class="btn-primary">CrÃ©er la session</button>
                <div id="create-error" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- Ã‰cran de connexion -->
    <div id="login-screen" class="screen">
        <div class="login-container">
            <h1 class="logo">ğŸ¥ CrÃªpe-Master</h1>
            <p class="tagline">SystÃ¨me de gestion de file de crÃªpes</p>
            
            <form id="login-form" onsubmit="return false;">
                <div class="input-group">
                    <input 
                        type="text" 
                        id="username-input" 
                        placeholder="Nom d'utilisateur" 
                        required
                        autocomplete="off"
                    >
                </div>
                
                <div class="input-group">
                    <input 
                        type="password" 
                        id="code-input" 
                        placeholder="Code d'accÃ¨s" 
                        required
                        autocomplete="off"
                    >
                </div>
                
                <button type="submit" class="btn-primary">Se connecter</button>
                <!--<button type="button" id="biometric-btn" class="btn-secondary" style="display: none;">
                    ğŸ” Connexion par empreinte
                </button>-->
                <div id="login-error" class="error-message"></div>
                <a href="#" id="forgot-password-link" style="display: block; text-align: center; margin-top: 15px; color: var(--accent-primary); text-decoration: none; font-size: 0.9rem;">Mot de passe oubliÃ© ?</a>
                <a href="#" id="create-account-link" style="display: block; text-align: center; margin-top: 10px; color: var(--accent-secondary); text-decoration: none; font-size: 0.9rem;">CrÃ©er un compte</a>
            </form>
        </div>
    </div>
    <!-- Modal de rÃ©initialisation de mot de passe -->
    <div id="reset-password-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h2>ğŸ” RÃ©initialiser le mot de passe</h2>
            <div id="reset-step-1" class="reset-step active">
                <p class="modal-info">Entre ton nom d'utilisateur pour recevoir un code sur Discord</p>
                <div class="input-group">
                    <input type="text" id="reset-username" placeholder="Nom d'utilisateur" autocomplete="off">
                </div>
                <button id="send-discord-code-btn" class="btn-primary">ğŸ“¨ Envoyer le code</button>
                <div id="reset-error-1" class="error-message"></div>
            </div>
            <div id="reset-step-2" class="reset-step" style="display: none;">
                <p class="modal-info">Entre le code reÃ§u sur Discord et ton nouveau mot de passe</p>
                <div class="input-group">
                    <input type="text" id="reset-code-input" placeholder="Code de vÃ©rification" autocomplete="off">
                </div>
                <div class="input-group">
                    <input type="password" id="new-password-input" placeholder="Nouveau mot de passe" autocomplete="off">
                </div>
                <div class="input-group">
                    <input type="password" id="confirm-password-input" placeholder="Confirmer le mot de passe" autocomplete="off">
                </div>
                <button id="reset-password-btn" class="btn-primary">âœ… RÃ©initialiser</button>
                <div id="reset-error-2" class="error-message"></div>
            </div>
            <button id="close-reset-modal" class="btn-secondary" style="margin-top: 20px;">Annuler</button>
        </div>
    </div>


    <!-- Modal de modification du compte -->
    <div id="edit-account-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h2>âš™ï¸ Modifier mon compte</h2>
            <div class="input-group">
                <label>Nom d'utilisateur (non modifiable)</label>
                <input type="text" id="edit-username-display" disabled>
            </div>
            <div class="input-group">
                <label>ID Discord</label>
                <input type="text" id="edit-discord-id" placeholder="Ton ID Discord">
                <small style="color: var(--text-secondary); display: block; margin-top: 5px;">
                    Pour obtenir ton ID: Active le mode dÃ©veloppeur dans Discord (ParamÃ¨tres â†’ AvancÃ©s â†’ Mode dÃ©veloppeur), 
                    puis clique droit sur ton profil â†’ Copier l'identifiant
                </small>
            </div>
            <div class="input-group">
                <label>Nouveau mot de passe (laisser vide pour ne pas changer)</label>
                <input type="password" id="edit-new-password" placeholder="Nouveau mot de passe" autocomplete="off">
            </div>
            <div class="input-group">
                <label>Confirmer le nouveau mot de passe</label>
                <input type="password" id="edit-confirm-password" placeholder="Confirmer" autocomplete="off">
            </div>
            <button id="save-account-btn" class="btn-primary">âœ… Enregistrer</button>
            <div id="edit-account-error" class="error-message"></div>
            <button id="close-edit-account-modal" class="btn-secondary" style="margin-top: 20px;">Annuler</button>
        </div>
    </div>

    <!-- Modal de crÃ©ation de compte -->
    <div id="register-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h2>âœ¨ CrÃ©er un compte</h2>
            <div id="register-step-1" class="register-step active">
                <p class="modal-info">Rejoins d'abord notre serveur Discord pour valider ton compte</p>
                <div class="input-group">
                    <label>Nom d'utilisateur</label>
                    <input type="text" id="register-username" placeholder="Ton nom d'utilisateur" autocomplete="off">
                </div>
                <div class="input-group">
                    <label>Mot de passe</label>
                    <input type="password" id="register-password" placeholder="Ton mot de passe" autocomplete="off">
                </div>
                <div class="input-group">
                    <label>Confirmer le mot de passe</label>
                    <input type="password" id="register-confirm-password" placeholder="Confirmer" autocomplete="off">
                </div>
                <div class="input-group">
                    <label>ID Discord</label>
                    <input type="text" id="register-discord-id" placeholder="Ton ID Discord">
                    <small style="color: var(--text-secondary); display: block; margin-top: 5px;">
                        Pour obtenir ton ID: Active le mode dÃ©veloppeur dans Discord (ParamÃ¨tres â†’ AvancÃ©s â†’ Mode dÃ©veloppeur), 
                        puis clique droit sur ton profil â†’ Copier l'identifiant
                    </small>
                </div>
                <a href="#" id="discord-invite-link" class="btn-primary" style="display: block; text-align: center; margin-bottom: 15px; text-decoration: none;" target="_blank">
                    ğŸ® Rejoindre le serveur Discord
                </a>
                <button id="send-verification-btn" class="btn-primary">ğŸ“¨ Envoyer le code de vÃ©rification</button>
                <div id="register-error-1" class="error-message"></div>
            </div>
            <div id="register-step-2" class="register-step" style="display: none;">
                <p class="modal-info">Entre le code reÃ§u sur Discord pour finaliser la crÃ©ation de ton compte</p>
                <div class="input-group">
                    <input type="text" id="register-code-input" placeholder="Code de vÃ©rification" autocomplete="off">
                </div>
                <button id="verify-account-btn" class="btn-primary">âœ… Valider mon compte</button>
                <div id="register-error-2" class="error-message"></div>
            </div>
            <button id="close-register-modal" class="btn-secondary" style="margin-top: 20px;">Annuler</button>
        </div>
    </div>

    <!-- Ã‰cran principal -->
    <div id="main-screen" class="screen">
        <header>
            <div class="header-content">
                <h1>ğŸ¥ CrÃªpe-Master</h1>
                <div class="user-info">
                    <span id="current-username"></span>
                    <button id="edit-account-btn" class="btn-secondary" style="margin-right: 10px;">âš™ï¸</button>
                    <button id="logout-btn" class="btn-logout">DÃ©connexion</button>
                </div>
            </div>
        </header>

        <main>
            <!-- Statut de la session -->
            <div id="session-status" class="session-status"></div>

            <!-- Carte de statut utilisateur -->
            <div class="status-card" id="user-status-card">
                <div class="status-header">
                    <h2>Ton Statut</h2>
                    <div class="status-badge" id="priority-badge"></div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Position</div>
                        <div class="stat-value" id="user-rank">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">CrÃªpes mangÃ©es</div>
                        <div class="stat-value" id="user-crepes">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Plaques actives</div>
                        <div class="stat-value" id="active-plates">0</div>
                    </div>
                </div>

                <div class="user-actions">
                    <button id="add-crepe-btn" class="btn-primary">ğŸ¥ J'ai mangÃ© une crÃªpe !</button>
                    <button id="skip-turn-btn" class="btn-secondary">Passer mon tour</button>
                </div>
            </div>

            <!-- File d'attente -->
            <div class="queue-section">
                <h2>File d'attente</h2>
                <div id="queue-list" class="queue-list"></div>
            </div>

            <!-- Panneau admin (visible uniquement pour les admins) -->
            <div id="admin-panel" class="admin-panel">
                <h2>ğŸ”§ Panneau Admin</h2>
                
                <div class="admin-section">
                    <label>
                        Nombre de plaques:
                        <input type="number" id="plates-input" min="1" max="10" value="2">
                    </label>
                    <button id="update-plates-btn" class="btn-admin">Mettre Ã  jour</button>
                </div>

                <div class="admin-section">
                    <label>
                        CoÃ»t total de la session (â‚¬):
                        <input type="number" id="cost-input" min="0" step="0.01" value="0">
                    </label>
                    <button id="update-cost-btn" class="btn-admin">Mettre Ã  jour</button>
                </div>

                <div class="admin-section">
                    <h3>Gestion des crÃªpes</h3>
                    <div id="admin-participants-list" class="admin-participants-list"></div>
                </div>

                <div class="admin-section">
                    <h3>Tests & Outils</h3>
                    <button id="test-vibration-btn" class="btn-admin">ğŸ“³ Tester les vibrations</button>
                    <button id="toggle-readonly-btn" class="btn-admin">ğŸ“– Activer mode lecture seule</button>
                </div>

                <div class="admin-section">
                    <button id="manage-sessions-btn" class="btn-admin">ğŸ”§ GÃ©rer les Sessions</button>
                </div>

                <div class="admin-section">
                    <button id="close-session-btn" class="btn-danger">ğŸ”’ ClÃ´turer la session</button>
                    <button id="reopen-session-btn" class="btn-admin" style="display: none;">ğŸ”“ Rouvrir la session</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de clÃ´ture -->
    <div id="close-modal" class="modal">
        <div class="modal-content">
            <h2>ğŸ“Š Session ClÃ´turÃ©e</h2>
            <p class="modal-info">La session de crÃªpes est terminÃ©e !</p>
            
            <div id="final-results" class="final-results"></div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="export-pdf-btn" class="btn-admin" style="flex: 1;">ğŸ“„ TÃ©lÃ©charger PDF</button>
                <button id="close-modal-btn" class="btn-primary" style="flex: 1;">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Toast de notification -->
    <div id="toast" class="toast"></div>

    <!-- Modal de gestion des sessions (Admin) -->
<div id="sessions-modal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>ğŸ”§ Gestion des Sessions</h2>
            <button id="close-sessions-modal" class="btn-secondary" style="padding: 5px 15px;">âœ•</button>
        </div>
        
        <!-- Onglets -->
        <div class="session-tabs">
            <button id="sessions-list-tab" class="tab-btn active">Liste des Sessions</button>
            <button id="current-session-tab" class="tab-btn">Session Actuelle</button>
            <button id="create-session-tab" class="tab-btn">CrÃ©er une Session</button>
        </div>

        <!-- Onglet: Liste des sessions -->
        <div id="sessions-list-content" class="tab-content active">
            <div id="all-sessions-list" class="sessions-grid"></div>
        </div>

        <!-- Onglet: Session actuelle -->
        <div id="current-session-content" class="tab-content">
            <div class="admin-section">
                <h3>ğŸ“Š Informations</h3>
                <div class="session-info-grid">
                    <div>
                        <strong>Nom:</strong>
                        <span id="modal-session-name"></span>
                    </div>
                    <div>
                        <strong>Code:</strong>
                        <span id="modal-session-code"></span>
                    </div>
                    <div>
                        <strong>Participants:</strong>
                        <span id="modal-participants-count"></span>
                    </div>
                    <div>
                        <strong>CrÃªpes totales:</strong>
                        <span id="modal-total-crepes"></span>
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h3>ğŸ‘¥ Membres de la session</h3>
                <div style="margin-bottom: 15px;">
                    <input type="text" id="add-member-username" placeholder="Nom d'utilisateur" style="margin-right: 10px;">
                    <input type="text" id="add-member-code" placeholder="Code" style="margin-right: 10px;">
                    <button id="add-member-btn" class="btn-admin">â• Ajouter</button>
                </div>
                <div id="modal-members-list" class="members-list"></div>
            </div>

            <div class="admin-section">
                <h3>ğŸ§¾ Export & Actions</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button id="export-ticket-btn" class="btn-admin">ğŸ§¾ Ticket de Caisse</button>
                    <button id="export-detailed-btn" class="btn-admin">ğŸ“„ Rapport DÃ©taillÃ©</button>
                    <button id="duplicate-session-btn" class="btn-admin">ğŸ“‹ Dupliquer</button>
                    <button id="archive-session-btn" class="btn-admin">ğŸ“¦ Archiver</button>
                    <button id="delete-session-btn" class="btn-danger">ğŸ—‘ï¸ Supprimer</button>
                </div>
            </div>
        </div>

        <!-- Onglet: CrÃ©er une session -->
        <div id="create-session-content" class="tab-content">
            <form id="admin-create-session-form">
                <div class="input-group">
                    <label>Nom de la session</label>
                    <input type="text" id="admin-session-name" required>
                </div>
                <div class="input-group">
                    <label>Code de session</label>
                    <input type="text" id="admin-session-code" required>
                </div>
                <div class="input-group">
                    <label>Nombre de plaques</label>
                    <input type="number" id="admin-session-plates" min="1" max="10" value="2">
                </div>
                <div class="input-group">
                    <label>CoÃ»t total (â‚¬)</label>
                    <input type="number" id="admin-session-cost" min="0" step="0.01" value="0">
                </div>
                <button type="submit" class="btn-primary">âœ… CrÃ©er la session</button>
            </form>
        </div>
    </div>
</div>
    <!-- Supabase Client via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Application JavaScript -->
    <script src="app.js"></script>
</body>
</html>